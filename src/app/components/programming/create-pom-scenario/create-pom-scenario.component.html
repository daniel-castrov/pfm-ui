<ng-template #emptycell><td></td></ng-template>
<j-header></j-header>
<div class="container-fluid">
  <div class="row main-content" *ngIf="header.isAuthenticated && community">
    <div class="col-md-12">
      <div class="row">
        <div class="col-lg-6 col-md-12 mb-2">
          <div class="h5 mb-2">
          <ng-container *ngIf="allowedits()">
            <span class="h5 mr-sm-2 mb-2">Create POM Scenario for FY {{fy}} based on PB</span>
            <select class="h6 form-control-sm" ([ngModel])="modelyear" (change)="setYear($event.target.value)">
              <option *ngFor="let y of years" [value]="y" [selected]="y===modelyear">{{y}}</option>
            </select>
          </ng-container>
          <ng-container *ngIf="!allowedits()">
            <span class="h5 mr-sm-2 mb-2">POM Scenario for FY {{fy}}</span>
          </ng-container>
          </div>
          <div id="toa1" class="table-editable">
            <div class="alert alert-danger" role="alert">
              <strong>Difference from TOA?</strong>
            </div>
            <table class="table">
              <tr class="toa-table-title">
                <td class="font-weight-bold toa-table-title" colspan="6">Set Overall TOA for {{community.abbreviation}} Community</td>
              </tr>
              <tr class="table-bordered">
                <th>Community</th>
                <th>{{fy}}</th>
                <th>{{fy+1}}</th>
                <th>{{fy+2}}</th>
                <th>{{fy+3}}</th>
                <th>{{fy+4}}</th>
                <th>Sum</th>
              </tr>
              <tr class="table-bordered">
                <td>{{community.abbreviation}} Overall</td>
                <td [attr.contenteditable]="allowedits()" (blur)="editfield($event, community.id, fy)" class="editable-field">{{toas.get(fy)}}</td>
                <td [attr.contenteditable]="allowedits()" (blur)="editfield($event, community.id, fy+1)" class="editable-field">{{toas.get(fy+1)}}</td>
                <td [attr.contenteditable]="allowedits()" (blur)="editfield($event, community.id, fy+2)" class="editable-field">{{toas.get(fy+2)}}</td>
                <td [attr.contenteditable]="allowedits()" (blur)="editfield($event, community.id, fy+3)" class="editable-field">{{toas.get(fy+3)}}</td>
                <td [attr.contenteditable]="allowedits()" (blur)="editfield($event, community.id, fy+4)" class="editable-field">{{toas.get(fy+4)}}</td>
                <td>{{orgsums.get(community.id)}}</td>
              </tr>
              <tr>
                <td class="font-weight-bold toa-table-title" colspan="6">Set Organization's sub-TOA</td>
              </tr>

              <tr class="table-bordered">
                <th>Organization</th>
                <th>{{fy}}</th>
                <th>{{fy+1}}</th>
                <th>{{fy+2}}</th>
                <th>{{fy+3}}</th>
                <th>{{fy+4}}</th>
                <th>Sum</th>
              </tr>

              <tr *ngFor="let o of orgs" class="table-bordered">
                <td>{{o.abbreviation}}</td>
                <td [attr.contenteditable]="allowedits()" (blur)="editfield($event, o.id, fy)" class="editable-field">{{orgtoas.get(o.id).get(fy)}}</td>
                <td [attr.contenteditable]="allowedits()" (blur)="editfield($event, o.id, fy+1)" class="editable-field">{{orgtoas.get(o.id).get(fy+1)}}</td>
                <td [attr.contenteditable]="allowedits()" (blur)="editfield($event, o.id, fy+2)" class="editable-field">{{orgtoas.get(o.id).get(fy+2)}}</td>
                <td [attr.contenteditable]="allowedits()" (blur)="editfield($event, o.id, fy+3)" class="editable-field">{{orgtoas.get(o.id).get(fy+3)}}</td>
                <td [attr.contenteditable]="allowedits()" (blur)="editfield($event, o.id, fy+4)" class="editable-field">{{orgtoas.get(o.id).get(fy+4)}}</td>
                <td>{{orgsums.get(o.id)}}</td>
              </tr>

              <tr>
                <td></td>
                <td *ngIf="yeardiffs.get(fy) < 0; else emptycell" class="exceed-sum">{{yeardiffs.get(fy)}}</td>
                <td *ngIf="yeardiffs.get(fy+1) < 0; else emptycell" class="exceed-sum">{{yeardiffs.get(fy+1)}}</td>
                <td *ngIf="yeardiffs.get(fy+2) < 0; else emptycell" class="exceed-sum">{{yeardiffs.get(fy+2)}}</td>
                <td *ngIf="yeardiffs.get(fy+3) < 0; else emptycell" class="exceed-sum">{{yeardiffs.get(fy+3)}}</td>
                <td *ngIf="yeardiffs.get(fy+4) < 0; else emptycell" class="exceed-sum">{{yeardiffs.get(fy+4)}}</td>
                <td></td>
              </tr>
            </table>
          </div>
        </div>
      </div>
      <div class="row" *ngIf="allowedits()">
        <div class="col-lg-8 col-md-12 mb-3">
          <button class="btn btn-primary" (click)="submit()">Create Scenario</button>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-8 col-md-12">
          <div class="h6">Progress Report:</div>
          <fieldset class="mb-3">
          </fieldset>
        </div>
      </div>
    </div>
  </div>
</div>
