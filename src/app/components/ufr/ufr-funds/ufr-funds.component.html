<ng-template #nomoney>
  <td class="text-right">-</td>
</ng-template>
<ng-template #nomoney_edit>
  <td class="text-right" contenteditable="true" class="editable-field" (blur)="onedit()">-</td>
</ng-template>

<div class="row" *ngIf="current">
  <div class="col-12 mb-3">
    <div id="pr-funds" class="table-editable">
      <table class="pr-funds-table">
        <thead>
          <tr class="white-top-table-header font-italic">
            <td></td>
            <td></td>
            <td></td>
            <td>PY-1</td>
            <td>PY</td>
            <td>CY</td>
            <td>BY</td>
            <td>BY+1</td>
            <td>BY+2</td>
            <td>BY+3</td>
            <td>BY+4</td>
            <td>CTC</td>
          </tr>
          <tr>
            <th class="header-column-width">Appropriation</th>
            <th class="header-column-width">Budget</th>
            <th>Cycle</th>
            <th>{{fy-3}}</th>
            <th>{{fy-2}}</th>
            <th>{{fy-1}}</th>
            <th>{{fy}}</th>
            <th>{{fy+1}}</th>
            <th>{{fy+2}}</th>
            <th>{{fy+3}}</th>
            <th>{{fy+4}}</th>
            <th>&gt;&gt;FY&lt;??&gt;</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let fund of current.fundingLines">
            <tr>
              <td class="row-lt-gray text-center" rowspan="3">{{fund.appropriation}}</td>
              <td class="row-lt-gray text-center" rowspan="3">{{fund.blin}}</td>
              <td>Current</td>
              <td class="text-right">{{modelfunds.get(fund.appropriation+fund.blin).funds[fy-3]}}</td>
              <td class="text-right">{{modelfunds.get(fund.appropriation+fund.blin).funds[fy-2]}}</td>
              <td class="text-right">{{modelfunds.get(fund.appropriation+fund.blin).funds[fy-1]}}</td>
              <td class="text-right">{{modelfunds.get(fund.appropriation+fund.blin).funds[fy]}}</td>
              <td class="text-right">{{modelfunds.get(fund.appropriation+fund.blin).funds[fy+1]}}</td>
              <td class="text-right">{{modelfunds.get(fund.appropriation+fund.blin).funds[fy+2]}}</td>
              <td class="text-right">{{modelfunds.get(fund.appropriation+fund.blin).funds[fy+3]}}</td>
              <td class="text-right">{{modelfunds.get(fund.appropriation+fund.blin).funds[fy+4]}}</td>
              <td class="text-right">-</td>
            </tr>
            <tr>
              <td>UFR</td>
              
              <td *ngIf="fund.funds[fy-3]; else nomoney" class="text-right">{{fund.funds[fy-3]}}</td>
              <td *ngIf="fund.funds[fy-2]; else nomoney" class="text-right">{{fund.funds[fy-2]}}</td>
              <td *ngIf="fund.funds[fy-1]; else nomoney" class="text-right">{{fund.funds[fy-1]}}</td>

              <td *ngIf="fund.funds[fy]; else nomoney_edit" contenteditable="true" class="editable-field" (blur)="onedit($event.target.textContent, fund.appropriation, fund.blin, fy)">{{fund.funds[fy]}}</td>
              <td *ngIf="fund.funds[fy+1]; else nomoney_edit" contenteditable="true" class="editable-field" (blur)="onedit($event.target.textContent, fund.appropriation, fund.blin, fy)">{{fund.funds[fy+1]}}</td>
              <td *ngIf="fund.funds[fy+2]; else nomoney_edit" contenteditable="true" class="editable-field" (blur)="onedit($event.target.textContent, fund.appropriation, fund.blin, fy)">{{fund.funds[fy+2]}}</td>
              <td *ngIf="fund.funds[fy+3]; else nomoney_edit" contenteditable="true" class="editable-field" (blur)="onedit($event.target.textContent, fund.appropriation, fund.blin, fy)">{{fund.funds[fy+3]}}</td>
              <td *ngIf="fund.funds[fy+4]; else nomoney_edit" contenteditable="true" class="editable-field" (blur)="onedit($event.target.textContent, fund.appropriation, fund.blin, fy)">{{fund.funds[fy+4]}}</td>

              <td>??</td>               
            </tr>
            <tr class="row-light">
              <td></td>
              <td class="text-right">{{fund.funds[fy-3]-modelfunds.get(fund.appropriation+fund.blin).funds[fy-3]}}</td>
              <td class="text-right">{{fund.funds[fy-2]-modelfunds.get(fund.appropriation+fund.blin).funds[fy-2]}}</td>
              <td class="text-right">{{fund.funds[fy-1]-modelfunds.get(fund.appropriation+fund.blin).funds[fy-1]}}</td>
              <td class="text-right">{{fund.funds[fy]-modelfunds.get(fund.appropriation+fund.blin).funds[fy]}}</td>
              <td class="text-right">{{fund.funds[fy+1]-modelfunds.get(fund.appropriation+fund.blin).funds[fy+1]}}</td>
              <td class="text-right">{{fund.funds[fy+2]-modelfunds.get(fund.appropriation+fund.blin).funds[fy+2]}}</td>
              <td class="text-right">{{fund.funds[fy+3]-modelfunds.get(fund.appropriation+fund.blin).funds[fy+3]}}</td>
              <td class="text-right">{{fund.funds[fy+4]-modelfunds.get(fund.appropriation+fund.blin).funds[fy+4]}}</td>
              <td class="text-right">-</td>
            </tr>
          </ng-container>

          <tr class="row-lt-gray font-weight-bold">
            <td class="text-center medium-grey-cell" colspan="2" rowspan="3">Total Funds Request</td>
            <td>Current</td>
            <td class="text-right">{{cvals.get(fy-3)}}</td>
            <td class="text-right">{{cvals.get(fy-2)}}</td>
            <td class="text-right">{{cvals.get(fy-1)}}</td>
            <td class="text-right">{{cvals.get(fy)}}</td>
            <td class="text-right">{{cvals.get(fy+1)}}</td>
            <td class="text-right">{{cvals.get(fy+2)}}</td>
            <td class="text-right">{{cvals.get(fy+3)}}</td>
            <td class="text-right">{{cvals.get(fy+4)}}</td>
            <td class="text-right">-</td>
          </tr>
          <tr class="row-lt-gray font-weight-bold">
            <td>UFR</td>
            <td class="text-right">{{uvals.get(fy-3)}}</td>
            <td class="text-right">{{uvals.get(fy-2)}}</td>
            <td class="text-right">{{uvals.get(fy-1)}}</td>
            <td class="text-right">{{uvals.get(fy)}}</td>
            <td class="text-right">{{uvals.get(fy+1)}}</td>
            <td class="text-right">{{uvals.get(fy+2)}}</td>
            <td class="text-right">{{uvals.get(fy+3)}}</td>
            <td class="text-right">{{uvals.get(fy+4)}}</td>
            <td class="text-right">-</td>
          </tr>
          <tr class="row-lt-gray font-weight-bold">
            <td>Delta</td>
            <td [ngClass]="{'text-right':true, 'text-danger': diffs[fy-3]<0 }">{{diffs[fy-3]}}</td>
            <td [ngClass]="{'text-right':true, 'text-danger': diffs[fy-2]<0 }">{{diffs[fy-2]}}</td>
            <td [ngClass]="{'text-right':true, 'text-danger': diffs[fy-1]<0 }">{{diffs[fy-1]}}</td>
            <td [ngClass]="{'text-right':true, 'text-danger': diffs[fy]<0 }">{{diffs[fy]}}</td>
            <td [ngClass]="{'text-right':true, 'text-danger': diffs[fy+1]<0 }">{{diffs[fy+1]}}</td>
            <td [ngClass]="{'text-right':true, 'text-danger': diffs[fy+2]<0 }">{{diffs[fy+2]}}</td>
            <td [ngClass]="{'text-right':true, 'text-danger': diffs[fy+3]<0 }">{{diffs[fy+3]}}</td>
            <td [ngClass]="{'text-right':true, 'text-danger': diffs[fy+4]<0 }">{{diffs[fy+4]}}</td>
            <td class="text-right  text-danger">-</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-10 mb-3">
    <fieldset>
      <legend>Add Funding Line #1</legend>
      <div class="row mb-3">
        <div class="col-2">
          <span class="form-group">
            <div class="mb-2 primary-label">Appropriation</div>
              <select class="form-control-sm dropdown-width">
               <option>RDT&amp;E</option>
             </select>
           </span>
        </div>
        <div class="col-2">
          <span class="form-group">
            <div class="mb-2 primary-label">BA/BLIN</div>
              <select class="form-control-sm dropdown-width">
               <option>BA7</option>
            </select>
          </span>
        </div>
        <div class="col-2">
          <span class="form-group">
            <div class="mb-2 primary-label">Item</div>
            <span class="form-group">
              <div class="mb-2 primary-label">Item Name</div>
            </span>
          </span>
        </div>
        <div class="col-2">
          <span class="form-group">
            <div class="mb-2 primary-label">OpAgency</div>
            <span class="form-group">
              <div class="mb-2 primary-label">OpAgency Name</div>
            </span>
          </span>
        </div>
        <div class="col-2">
          <span class="form-group">
            <div class="mb-2 primary-label">Program Element</div>
            <span class="form-group">
              <div class="mb-2 primary-label">Program Element Name</div>
            </span>
          </span>
        </div>
      </div>
      <div class="row mb-4">
        <div class="col-10">
          <div id="pr-funding-line" class="table-editable">
            <table class="pr-funds-table">
              <thead>
                <tr>
                  <th>FY19</th>
                  <th>FY20</th>
                  <th>FY21</th>
                  <th>FY22</th>
                  <th>FY23</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td contenteditable="true" class="editable-field">-</td>
                  <td contenteditable="true" class="editable-field">-</td>
                  <td contenteditable="true" class="editable-field">-</td>
                  <td contenteditable="true" class="editable-field">8,077</td>
                  <td contenteditable="true" class="editable-field">10,898</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </fieldset>
  </div>
  <div class="col-2">
    <button class="btn btn-primary">
      <i class="fa fa-plus-circle icon-pad" aria-hidden="true"></i>
      Add Funding Line
    </button>
  </div>
</div>
